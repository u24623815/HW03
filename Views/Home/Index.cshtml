@model HW03.Models.HomeViewModel
@{
    ViewBag.Title = "Bike Store - Home";
}

<div class="container-fluid">
    <h1 class="mb-4">Bike Store Dashboard</h1>

    <!-- Success/Error Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    <!-- Action Buttons -->
    <div class="row mb-4">
        <div class="col-md-6">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createStaffModal">
                Create New Staff
            </button>
            <button type="button" class="btn btn-success ml-2" data-toggle="modal" data-target="#createCustomerModal">
                Create New Customer
            </button>
        </div>
    </div>

    <!-- Display Position Selectors -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="form-inline">
                <label class="mr-2">Show Staff:</label>
                <select id="staffPositionFilter" class="form-control form-control-sm">
                    <option value="0">All Staff</option>
                    @for (int i = 1; i <= Model.Staffs.Count; i++)
                    {
                        <option value="@i">Staff #@i</option>
                    }
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-inline">
                <label class="mr-2">Show Customer:</label>
                <select id="customerPositionFilter" class="form-control form-control-sm">
                    <option value="0">All Customers</option>
                    @for (int i = 1; i <= Model.Customers.Count; i++)
                    {
                        <option value="@i">Customer #@i</option>
                    }
                </select>
            </div>
        </div>
    </div>

    <!-- Page Merging Layout -->
    <div class="row">
        <!-- Staffs Section -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        Staff Members
                        <span class="badge badge-warning float-right">@Model.Staffs.Count</span>
                    </h5>
                </div>
                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                    <div id="staffList">
                        @if (Model.Staffs.Any())
                        {
                            foreach (var staff in Model.Staffs)
                            {
                                <div class="card mb-2 staff-item">
                                    <div class="card-body p-3">
                                        <h6 class="card-title">@staff.first_name @staff.last_name</h6>
                                        <p class="card-text mb-1">
                                            <small class="text-muted">
                                                <strong>Staff ID:</strong> @staff.staff_id<br />
                                                <strong>Email:</strong> @staff.email<br />
                                                <strong>Phone:</strong> @staff.phone<br />
                                                <strong>Active:</strong> @(staff.active == 1 ? "Yes" : "No")<br />
                                                <strong>Store:</strong> @staff.StoreName<br />
                                                <strong>Manager:</strong> @staff.ManagerName
                                            </small>
                                        </p>

                                        <!-- Sold Products Section -->
                                        @if (staff.SoldProducts != null && staff.SoldProducts.Any())
                                        {
                                            <div class="mt-2">
                                                <strong>Sold Items:</strong>
                                                <div style="max-height: 120px; overflow-y: auto;">
                                                    @foreach (var item in staff.SoldProducts.Take(5))
                                                    {
                                                        <div class="border-top pt-1 mt-1">
                                                            <small>
                                                                <strong>@item.ProductName</strong><br />
                                                                Sold to: @item.CustomerName<br />
                                                                Quantity: @item.Quantity | Date: @item.OrderDate.ToString("MMM dd, yyyy")
                                                            </small>
                                                        </div>
                                                    }
                                                    @if (staff.SoldProducts.Count > 5)
                                                    {
                                                        <small class="text-muted">+ @(staff.SoldProducts.Count - 5) more items sold...</small>
                                                    }
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="mt-2">
                                                <small class="text-muted">No items sold yet</small>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p class="text-muted">No staff members found.</p>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Customers Section -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        Customers
                        <span class="badge badge-warning float-right">@Model.Customers.Count</span>
                    </h5>
                </div>
                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                    <div id="customerList">
                        @if (Model.Customers.Any())
                        {
                            foreach (var customer in Model.Customers)
                            {
                                <div class="card mb-2 customer-item">
                                    <div class="card-body p-3">
                                        <h6 class="card-title">@customer.first_name @customer.last_name</h6>
                                        <p class="card-text mb-1">
                                            <small class="text-muted">
                                                <strong>Customer ID:</strong> @customer.customer_id<br />
                                                <strong>Email:</strong> @customer.email<br />
                                                <strong>Phone:</strong> @customer.phone<br />
                                                <strong>Location:</strong> @customer.city, @customer.state
                                            </small>
                                        </p>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p class="text-muted">No customers found.</p>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Section with Filter -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">
                        Products
                        <span class="badge badge-warning float-right">@Model.Products.Count</span>
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Filter Form -->
                    @using (Html.BeginForm("Index", "Home", FormMethod.Get))
                    {
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label>Filter by Brand:</label>
                                @Html.DropDownList("brandFilter", ViewBag.Brands as SelectList, "All Brands", new { @class = "form-control", onchange = "this.form.submit()" })
                            </div>
                            <div class="col-md-6">
                                <label>Filter by Category:</label>
                                @Html.DropDownList("categoryFilter", ViewBag.Categories as SelectList, "All Categories", new { @class = "form-control", onchange = "this.form.submit()" })
                            </div>
                        </div>
                    }

                    <!-- Products List -->
                    <div style="max-height: 400px; overflow-y: auto;">
                        @if (Model.Products.Any())
                        {
                            foreach (var product in Model.Products)
                            {
                                <div class="card mb-3">
                                    <div class="card-body p-2">
                                        <!-- Product Image -->
                                        <div class="text-center mb-2">
                                            <img src="@Url.Content(product.ImagePath)"
                                                 alt="@product.product_name"
                                                 class="img-fluid rounded"
                                                 style="max-height: 120px; width: auto;"
                                                 onerror="this.src='@Url.Content("~/Content/Images/default_bike.jpeg")'; this.alt='Default Bike Image'" />
                                        </div>

                                        <h6 class="card-title text-center">@product.product_name</h6>
                                        <p class="card-text mb-1">
                                            <small class="text-muted">
                                                <strong>Product ID:</strong> @product.product_id<br />
                                                <strong>Brand:</strong> @product.brand_name<br />
                                                <strong>Category:</strong> @product.category_name<br />
                                                <strong>Year:</strong> @product.model_year<br />
                                                <strong>Price:</strong> $@product.list_price
                                            </small>
                                        </p>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p class="text-muted">No products found matching your criteria.</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Staff Modal -->
<div class="modal fade" id="createStaffModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Create New Staff Member</h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <form action="@Url.Action("CreateStaff", "Home")" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" name="first_name" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" name="last_name" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="text" name="phone" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Store *</label>
                        @Html.DropDownList("store_id", ViewBag.Stores as SelectList, "Select Store", new { @class = "form-control", required = "required" })
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Staff</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Customer Modal -->
<div class="modal fade" id="createCustomerModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Create New Customer</h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <form action="@Url.Action("CreateCustomer", "Home")" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" name="first_name" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" name="last_name" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="text" name="phone" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" name="city" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <input type="text" name="state" class="form-control" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Create Customer</button>
                </div>
            </form>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            // Staff position filter - show specific staff by position
            $('#staffPositionFilter').change(function () {
                var position = parseInt($(this).val());
                var $staffItems = $('.staff-item');

                if (position === 0) {
                    // Show all staff
                    $staffItems.show();
                } else {
                    // Hide all staff first
                    $staffItems.hide();
                    // Show only the staff at the selected position (1-based index)
                    $staffItems.eq(position - 1).show();
                }
            });

            // Customer position filter - show specific customer by position
            $('#customerPositionFilter').change(function () {
                var position = parseInt($(this).val());
                var $customerItems = $('.customer-item');

                if (position === 0) {
                    // Show all customers
                    $customerItems.show();
                } else {
                    // Hide all customers first
                    $customerItems.hide();
                    // Show only the customer at the selected position (1-based index)
                    $customerItems.eq(position - 1).show();
                }
            });

            // Product filtering (existing)
            $('#brandFilter, #categoryFilter').change(function () {
                this.form.submit();
            });
        });
    </script>
}